---
import { getCollection, getEntry } from 'astro:content';
import BlogPost from '../../../layouts/BlogPost.astro';

export async function getStaticPaths() {
	const posts = await getCollection('posts', (post) => post.data.lang === 'en' && !post.data.draft);

	return posts.map((post) => {
		const routeSlug = post.slug.split('/').pop() ?? post.slug;
		return {
			params: { slug: routeSlug },
			props: { entrySlug: post.slug, routeSlug },
		};
	});
}

const { entrySlug, routeSlug } = Astro.props;
const post = await getEntry('posts', entrySlug);

if (!post) {
	throw new Error(`Post not found for slug: ${routeSlug}`);
}

const { Content } = await post.render();
---

<BlogPost
	title={post.data.title}
	description={post.data.description}
	pubDate={post.data.pubDate}
	updatedDate={post.data.updatedDate}
	heroImage={post.data.heroImage}
	heroAlt={post.data.heroAlt}
	tags={post.data.tags}
	author={post.data.author}
	lang="en"
	content={post.body}
	slug={routeSlug}
	entrySlug={post.slug}
	translationKey={post.data.translationKey}
>
	<Content />
</BlogPost>
